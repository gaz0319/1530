<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Pitt Club Events Viewer</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div class="app">
    <h1>Pitt Club Events</h1>
    <p id="status">Loading eventsâ€¦</p>
    <ul id="events"></ul>
  </div>
  <script>
    async function fetchFromOrigins(origins) {
      for (const origin of origins) {
        try {
          const response = await fetch(`${origin}/events/`);
          if (!response.ok) continue;
          return response.json();
        } catch {
          // try next origin
        }
      }
      throw new Error('No backend origins responded.');
    }

    async function loadEvents() {
      const status = document.getElementById('status');
      const list = document.getElementById('events');
      const origins = [];

      if (window.location.origin && window.location.origin.startsWith('http')) {
        origins.push(window.location.origin);
      }
      origins.push('http://127.0.0.1:8000', 'http://localhost:8000');

      try {
        const events = await fetchFromOrigins(origins);
        if (!events.length) {
          status.textContent = 'No events found.';
          return;
        }
        status.textContent = `${events.length} event${events.length === 1 ? '' : 's'} available:`;
        events.forEach((event) => {
          const formattedTime = new Intl.DateTimeFormat([], {
            dateStyle: 'medium',
            timeStyle: 'short',
          }).format(new Date(event.date));
          const item = document.createElement('li');
          item.innerHTML = `
            <details>
              <summary>
                <span class="title">${event.name}</span>
                <time class="event-time">${formattedTime}</time>
              </summary>
              <div class="details-body">
                <p><strong>Organization:</strong> ${event.organization}</p>
                <p><strong>Location:</strong> ${event.location}</p>
                <p><strong>Category:</strong> ${event.category}</p>
              </div>
            </details>
          `;
          list.appendChild(item);
        });
      } catch (error) {
        console.error(error);
        status.textContent = 'Unable to load events. Make sure the Django server is running on 127.0.0.1:8000 or localhost:8000.';
      }
    }

    loadEvents();
  </script>
</body>
</html>
